{% extends 'base.html' %}

{% block title %}Editar Orden #{{ orden.id }} - CRM PACS{% endblock %}

{% block extra_css %}
<style>
    .page-header { margin-bottom: 2rem; }
    .page-title { font-size: 2rem; font-weight: 700; color: var(--color-primario); }

    .order-form { background: var(--color-fondo-card); border: 1px solid var(--color-borde); border-radius: 12px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
    
    .form-section { margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed var(--color-borde); }
    .form-section h2 { font-size: 1.25rem; font-weight: 600; color: var(--color-primario); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; }
    
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem 2rem; }
    .form-group { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
    
    label { font-size: 0.9rem; font-weight: 600; color: var(--color-texto-secundario); }
    input, select, textarea { width: 100%; padding: 0.85rem 1rem; border-radius: 8px; border: 1px solid var(--color-borde); background: var(--color-input-bg); font-size: 0.95rem; font-family: 'Inter', sans-serif; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--color-primario); }
    
    /* Info estática (Readonly) */
    .static-info { background: #f8f9fa; padding: 1rem; border-radius: 8px; border: 1px solid #e9ecef; }
    .static-info strong { color: #333; }
    .static-info small { color: #666; display: block; margin-top: 0.25rem; }

    .form-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; }
</style>
{% endblock %}

{% block content %}

    <div class="page-header">
        <h1 class="page-title">Editar Orden #{{ orden.id }}</h1>
    </div>

    <form method="POST" class="order-form">
        {% csrf_token %}
        
        <!-- SECCIÓN 1: CLIENTE (Solo Lectura) -->
        <section class="form-section">
            <h2><svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Cliente</h2>
            <div class="static-info">
                <strong>{{ orden.cliente.nombre_completo }}</strong>
                <small>Tel: {{ orden.cliente.telefono }} | RFC: {{ orden.cliente.rfc|default:"--" }}</small>
            </div>
        </section>

        <!-- SECCIÓN 2: EQUIPO (Solo Lectura) -->
        <section class="form-section">
            <h2><svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> Equipo</h2>
            <div class="static-info">
                <strong>{{ orden.equipo.tipo_equipo }} {{ orden.equipo.marca }} {{ orden.equipo.modelo }}</strong>
                <small>Serie: {{ orden.equipo.numero_serie|default:"S/N" }}</small>
            </div>
        </section>

        <!-- SECCIÓN 3: DETALLES DEL SERVICIO (Editable) -->
        <section class="form-section">
            <h2><svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg> Detalles del Servicio</h2>
            
            <div class="form-group">
                <label for="descripcion_falla">Descripción de la Falla</label>
                <textarea name="descripcion_falla" id="descripcion_falla" rows="4" required>{{ orden.descripcion_falla }}</textarea>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="estado">Estado de la Orden</label>
                    <select name="estado" id="estado">
                        {% for codigo, nombre in estados %}
                            <option value="{{ codigo }}" {% if orden.estado == codigo %}selected{% endif %}>{{ nombre }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="contrasena">Contraseña Equipo</label>
                    <input type="text" name="contrasena_equipo" id="contrasena" value="{{ orden.contrasena_equipo|default:'' }}">
                </div>
                
                <div class="form-group">
                    <label for="prioridad">Prioridad</label>
                    <select name="prioridad" id="prioridad">
                        {% for codigo, nombre in prioridades %}
                            <option value="{{ codigo }}" {% if orden.prioridad == codigo %}selected{% endif %}>{{ nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="tecnico">Técnico Asignado</label>
                    <select name="tecnico_asignado" id="tecnico">
                        <option value="">-- Sin asignar --</option>
                        {% for tecnico in tecnicos_list %}
                            <option value="{{ tecnico.id }}" {% if orden.tecnico_asignado.id == tecnico.id %}selected{% endif %}>
                                {{ tecnico.first_name }} {{ tecnico.last_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </section>

        <div class="form-actions">
            <a href="{% url 'lista_ordenes' %}" class="btn btn-secondary" style="text-decoration: none; background:#fff; border:1px solid #ccc; color:#333;">Cancelar</a>
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
    </form>

{% endblock %}