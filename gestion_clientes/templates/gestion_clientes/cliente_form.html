{% extends 'base.html' %}

{% block title %}{% if cliente %}Editar{% else %}Nuevo{% endif %} Cliente - CRM PACS{% endblock %}

{% block extra_css %}
<style>
    .page-header { margin-bottom: 2rem; text-align: center; }
    .page-title { font-size: 2rem; font-weight: 700; color: var(--color-primario); }

    .form-card { 
        background: var(--color-fondo-card); 
        border: 1px solid var(--color-borde); 
        border-radius: 12px; 
        padding: 2.5rem; 
        max-width: 800px; 
        margin: 0 auto; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    }

    .form-section-title {
        font-size: 1.1rem; font-weight: 600; color: var(--color-primario);
        margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px dashed var(--color-borde);
    }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
    .form-group { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
    
    label { font-weight: 600; font-size: 0.9rem; color: var(--color-texto-secundario); }
    input {
        padding: 0.85rem 1rem; border-radius: 8px; border: 1px solid var(--color-borde);
        background-color: var(--color-input-bg); font-family: 'Inter', sans-serif; font-size: 0.95rem;
    }
    input:focus { outline: none; border-color: var(--color-primario); }

    .form-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; border-top: 1px solid var(--color-borde); padding-top: 1.5rem; }

    /* Mensajes de alerta (Solo para errores de validación en esta vista) */
    .alert { padding: 1rem; margin-bottom: 1.5rem; border-radius: 8px; max-width: 800px; margin-left: auto; margin-right: auto; }
    .alert-error { background-color: #ffebee; color: #b71c1c; border: 1px solid #ef9a9a; }
    /* Success se maneja en el detalle ahora, pero lo dejamos por seguridad */
    .alert-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

    @media (max-width: 768px) {
        .form-row { grid-template-columns: 1fr; gap: 0; }
    }
</style>
{% endblock %}

{% block content %}

    <div class="page-header">
        <h1 class="page-title">{% if cliente %}Editar Cliente{% else %}Registrar Nuevo Cliente{% endif %}</h1>
    </div>

    <!-- Mantenemos esto para mostrar ERRORES de validación (ej. Teléfono duplicado) -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="form-card">
        <form method="POST">
            {% csrf_token %}
            
            <!-- DATOS PERSONALES -->
            <div class="form-section-title">Datos de Contacto</div>
            
            <div class="form-group">
                <label for="nombre_completo">Nombre Completo *</label>
                <input type="text" name="nombre_completo" id="nombre_completo" 
                       value="{% if cliente %}{{ cliente.nombre_completo }}{% elif values %}{{ values.nombre_completo }}{% endif %}" 
                       required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="telefono">Teléfono *</label>
                    <input type="tel" name="telefono" id="telefono" 
                           value="{% if cliente %}{{ cliente.telefono }}{% elif values %}{{ values.telefono }}{% endif %}" 
                           required>
                </div>
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" name="email" id="email" 
                           value="{% if cliente %}{{ cliente.email|default:'' }}{% elif values %}{{ values.email }}{% endif %}">
                </div>
            </div>

            <div class="form-group">
                <label for="rfc">RFC</label>
                <input type="text" name="rfc" id="rfc" 
                       value="{% if cliente %}{{ cliente.rfc|default:'' }}{% elif values %}{{ values.rfc }}{% endif %}" 
                       placeholder="Opcional">
            </div>

            <!-- DIRECCIÓN -->
            <div class="form-section-title" style="margin-top: 1.5rem;">Dirección (Opcional)</div>

            <div class="form-row">
                <div class="form-group">
                    <label for="calle">Calle</label>
                    <input type="text" name="calle" id="calle" 
                           value="{% if cliente %}{{ cliente.calle|default:'' }}{% elif values %}{{ values.calle }}{% endif %}">
                </div>
                <div class="form-group">
                    <label for="colonia">Colonia</label>
                    <input type="text" name="colonia" id="colonia" 
                           value="{% if cliente %}{{ cliente.colonia|default:'' }}{% elif values %}{{ values.colonia }}{% endif %}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="numero_exterior">No. Exterior</label>
                    <input type="text" name="numero_exterior" id="numero_exterior" 
                           value="{% if cliente %}{{ cliente.numero_exterior|default:'' }}{% elif values %}{{ values.numero_exterior }}{% endif %}">
                </div>
                <div class="form-group">
                    <label for="numero_interior">No. Interior</label>
                    <input type="text" name="numero_interior" id="numero_interior" 
                           value="{% if cliente %}{{ cliente.numero_interior|default:'' }}{% elif values %}{{ values.numero_interior }}{% endif %}">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="codigo_postal">Código Postal</label>
                    <input type="text" name="codigo_postal" id="codigo_postal" 
                           value="{% if cliente %}{{ cliente.codigo_postal|default:'' }}{% elif values %}{{ values.codigo_postal }}{% endif %}">
                </div>
                <div class="form-group">
                    <label for="ciudad">Ciudad</label>
                    <input type="text" name="ciudad" id="ciudad" 
                           value="{% if cliente %}{{ cliente.ciudad|default:'' }}{% elif values %}{{ values.ciudad }}{% endif %}">
                </div>
            </div>
            
            <div class="form-group">
                <label for="estado">Estado</label>
                <input type="text" name="estado" id="estado" 
                       value="{% if cliente %}{{ cliente.estado|default:'' }}{% elif values %}{{ values.estado }}{% endif %}">
            </div>

            <!-- BOTONES -->
            <div class="form-actions">
                <a href="javascript:history.back()" class="btn btn-secondary" style="text-decoration: none; border: 1px solid #ccc; color: #333;">Cancelar</a>
                <button type="submit" class="btn btn-primary">
                    {% if cliente %}Guardar Cambios{% else %}Registrar Cliente{% endif %}
                </button>
            </div>
        </form>
    </div>

{% endblock %}